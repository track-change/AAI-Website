---
import type { InferGetStaticParamsType } from "astro";
import { PortableText } from "astro-portabletext";
import ArtistLayout from "../../layouts/ArtistLayout.astro";
import CTADefault from "../../components/CTA-Button.astro";
import { getArtistBySlug, getArtists } from "../../data/api";
import { urlFor } from "../../utils/image";

export async function getStaticPaths() {
  const artists = await getArtists();
  return artists.map((artist) => {
    return {
      params: { slug: artist.slug.current },
    };
  });
}

type Params = InferGetStaticParamsType<typeof getStaticPaths>;
const { slug } = Astro.params as Params;

const artist = await getArtistBySlug(slug);
---

<ArtistLayout
  pageTitle={artist.name}
  bannerSrc={urlFor(artist.image).url()}
  credits={artist.imageCredit}
>
  <div class="front-caption">
    <CTADefault
      ctas={artist.links.map((link) => {
        return {
          title: link._type,
          url: link.url,
        };
      })}
    />
  </div>
  <section class="body-copy">
    <PortableText value={artist.bio} />
  </section>
</ArtistLayout>
